#!/bin/bash

set -e
set -x

declare -a LOGOS
declare -a SIZES
declare -a VARIANTS

rm zips/* -Rf

LOGOS[0]=''
LOGOS[1]='Changelog'
LOGOS[2]='Express'
LOGOS[3]='Site'

SIZES[0]='3000 3000'

VARIANTS[0]='White'
VARIANTS[1]='Dark'
VARIANTS[2]='White_Transparent'
VARIANTS[3]='Dark_Transparent'

declare -A VARIANT_COLOR_BACKGROUND_MAP
VARIANT_COLOR_BACKGROUND_MAP['White']='#0e2430'
VARIANT_COLOR_BACKGROUND_MAP['Dark']='#fff'
VARIANT_COLOR_BACKGROUND_MAP['White_Transparent']='transparent'
VARIANT_COLOR_BACKGROUND_MAP['Dark_Transparent']='transparent'

declare -A VARIANT_COLOR_FOREGROUND_MAP
VARIANT_COLOR_FOREGROUND_MAP['White']='#fff'
VARIANT_COLOR_FOREGROUND_MAP['Dark']='#0e2430'
VARIANT_COLOR_FOREGROUND_MAP['White_Transparent']='#fff'
VARIANT_COLOR_FOREGROUND_MAP['Dark_Transparent']='#0e2430'

function generate {
    # $1 logo
    # $2 witdh
    # $3 height
    # $4 background
    # $5 foreground
    # $6 variant
    sed "s/{project_name}/$1/" src/megafono-v1-project.svg | sed "s/{background}/$4/" | sed "s/{width}/$2/" | sed "s/{height}/$3/" | sed "s/{foreground}/$5/" > compiled/Megafono$1/Megafono$1_$6.svg

    svgexport compiled/Megafono$1/Megafono$1_$6.svg compiled/Megafono$1/Megafono$1_$6_$2x$3.png png 100% $2:$3
    pngquant -f --ext .png compiled/Megafono$1/Megafono$1_$6_$2x$3.png
}

function generate-logo {
    # $1 witdh
    # $2 height
    # $3 background
    # $4 foreground
    # $5 variant
    # $6 horizontal?
    sed "s/{background}/$3/" src/megafono-v1$6.svg | sed "s/{width}/$1/" | sed "s/{height}/$2/" | sed "s/{foreground}/$4/" > compiled/Megafono$6/Megafono_$5.svg

    svgexport compiled/Megafono$6/Megafono_$5.svg compiled/Megafono$6/Megafono_$5_$1x$2.png png 100% $1:$2
    pngquant -f --ext .png compiled/Megafono$6/Megafono_$5_$1x$2.png
}


for name in "${LOGOS[@]}"
do
    for sizes in "${SIZES[@]}"
    do
        for variant in "${VARIANTS[@]}"
        do
            arr=(${sizes// / })
            width=${arr[0]}
            height=${arr[1]}
            background=${VARIANT_COLOR_BACKGROUND_MAP[$variant]}
            foreground=${VARIANT_COLOR_FOREGROUND_MAP[$variant]}

            if [ "$name" = "" ]; then
                mkdir -p compiled/Megafono
                generate-logo $width $height $background $foreground $variant ""

                    mkdir -p compiled/Megafonohorizontal
                generate-logo $width $(((500*width)/2150)) $background $foreground $variant "horizontal"
            else
                mkdir -p compiled/Megafono$name
                generate ${name} $width $height $background $foreground $variant
            fi
        done
    done

    (cd compiled/Megafono$name && zip -r ../../zips/Megafono$name.zip .)
done

# rm compiled -Rf
